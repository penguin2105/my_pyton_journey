import telebot
import requests
from bs4 import BeautifulSoup
from telebot import types

bot = telebot.TeleBot("7814951497:AAHM4Gg_PwhCjZQJ3aNltWjniCWfmCOJRPY")

def get_currency_rate(currency):
    try:
        url = "https://www.cbr.ru/currency_base/daily/"
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'html.parser')
        
        if currency == 'USD':
            rate = soup.find('td', text='Доллар США').find_next_sibling('td').text
            return f"Курс USD: {rate} руб."
        elif currency == 'EUR':
            rate = soup.find('td', text='Евро').find_next_sibling('td').text
            return f"Курс EUR: {rate} руб."
        return "Неизвестная валюта"
    except Exception as e:
        print(f"Ошибка: {e}")
        return "Не удалось получить курс"

def get_currency_rates():
    try:
        url = "https://www.cbr.ru/currency_base/daily/"
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'html.parser')
        
        usd_rate = soup.find('td', text='Доллар США').find_next_sibling('td').text
        eur_rate = soup.find('td', text='Евро').find_next_sibling('td').text
        
        return f"USD: {usd_rate} руб.\nEUR: {eur_rate} руб."
    except Exception as e:
        print(f"Ошибка при получении курса: {e}")
        return "Не удалось получить текущие курсы валют"

@bot.message_handler(commands=['start'])  
def send_welcome(message):
    bot.reply_to(message, "Привет, я К.Ю! Напиши команду /rates для получения курса валют")

@bot.message_handler(commands=['rates'])  
def set_rates(message):
    markup = types.ReplyKeyboardMarkup(row_width=2)
    btn_usd = types.KeyboardButton('USD')
    btn_eur = types.KeyboardButton('EUR')
    markup.add(btn_usd, btn_eur)
    bot.send_message(message.chat.id, "Выбери валюту:", reply_markup=markup)

@bot.message_handler(func=lambda message: message.text in ['USD', 'EUR'])
def send_specific_rate(message):
    rate = get_currency_rate(message.text)
    bot.send_message(message.chat.id, rate)

print("Бот запущен...")
bot.polling()
    updater.start_polling()
    updater.idle()

if __name__ == '__main__':
    main()
